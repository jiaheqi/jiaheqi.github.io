<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Android apk反编译与篡改</title>
    <url>/2025/01/03/Android-apk%E5%8F%8D%E7%BC%96%E8%AF%91%E4%B8%8E%E7%AF%A1%E6%94%B9/</url>
    <content><![CDATA[<h2 id="jadx-gui反编译"><a href="#jadx-gui反编译" class="headerlink" title="jadx gui反编译"></a>jadx gui反编译</h2><h3 id="安装与启动"><a href="#安装与启动" class="headerlink" title="安装与启动"></a>安装与启动</h3><blockquote>
<p>参考文档：<a class="link"   href="https://blog.csdn.net/qq_38393270/article/details/132046040" >https://blog.csdn.net/qq_38393270/article/details/132046040<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</blockquote>
<p>安装</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">brew install jadx</span><br></pre></td></tr></table></figure></div>

<p>启动</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">jadx-gui</span><br></pre></td></tr></table></figure></div>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>直接把apk拖进去打开就ok了，然后可以根据关键词搜索。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-03-18-23-57.png"
                      alt="2025-01-03-18-23-57.png"
                ></p>
<h2 id="apktool反编译和编译"><a href="#apktool反编译和编译" class="headerlink" title="apktool反编译和编译"></a>apktool反编译和编译</h2><blockquote>
<p>参考文档<br><a class="link"   href="https://blog.csdn.net/greatsam/article/details/137049910" >https://blog.csdn.net/greatsam/article/details/137049910<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a><br><a class="link"   href="https://www.cnblogs.com/andy0816/p/15174370.html" >https://www.cnblogs.com/andy0816/p/15174370.html<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a><br><a class="link"   href="https://developer.android.com/tools/apksigner?hl=zh-cn#options-sign" >https://developer.android.com/tools/apksigner?hl=zh-cn#options-sign<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</blockquote>
<h3 id="反编译"><a href="#反编译" class="headerlink" title="反编译"></a>反编译</h3><p>所有的java文件都是以smali的形式反编译出来的，修改smali其中的代码即可<br>如果项目中使用了ts的代码，那么编译之后会存在js文件中</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">apktool d app-china-debug.apk -o zeusdemo</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-03-18-25-42.png"
                      alt="2025-01-03-18-25-42.png"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-03-18-25-52.png"
                      alt="2025-01-03-18-25-52.png"
                ></p>
<h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">apktool b zeusdemo -o zeusdemonew.apk</span><br></pre></td></tr></table></figure></div>

<h2 id="apksigner签名"><a href="#apksigner签名" class="headerlink" title="apksigner签名"></a>apksigner签名</h2><blockquote>
<p>如果不签名，导出的 apk 无法安装; apksigner 是安装 Android SDK 默认包含的 tool</p>
</blockquote>
<ol>
<li>找到 SDK 目录位置，从而找到 apksigner 的位置<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-03-18-27-25.png"
                      alt="2025-01-03-18-27-25.png"
                ></li>
<li>对修改完代码的 apk 进行签名</li>
</ol>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">./apksigner sign --ks /Users/topjoy/tools/apktool/jiaheqi.jks  --out /Users/topjoy/tools/apktool/signedzeusdemo.apk /Users/topjoy/tools/apktool/zeusdemonew.apk</span><br></pre></td></tr></table></figure></div>

<p>如果没有 jks 签名文件需要生成一个，生成的时候可以借助 Android Studio 生成（也可以通过 apksigner 的命令生成）<br>打开 Build-Generate Signed App Bundle or APK-选择 APK-Next-Create new，可以创建新的签名文件<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-03-18-28-43.png"
                      alt="2025-01-03-18-28-43.png"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-03-18-28-49.png"
                      alt="2025-01-03-18-28-49.png"
                ><br>3. 签名后的 APK 安装后可以正常运行</p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android apk 签名</title>
    <url>/2025/01/02/Android-apk%E7%AD%BE%E5%90%8D/</url>
    <content><![CDATA[<h2 id="查看apk签名"><a href="#查看apk签名" class="headerlink" title="查看apk签名"></a>查看apk签名</h2><blockquote>
<p>参考文档：<a class="link"   href="https://developers.google.com/android/guides/client-auth?hl=zh-cn" >https://developers.google.com/android/guides/client-auth?hl=zh-cn<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</blockquote>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 方式一</span></span><br><span class="line">keytool -printcert -jarfile /Users/topjoy/Desktop/zeusbuild.apk</span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line">jarsigner -verify -verbose -certs app-release.apk </span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-02-18-29-27.png"
                      alt="001"
                ></p>
<p>firebase后台：<a class="link"   href="https://console.firebase.google.com/u/1/project/dao-project-380602/settings/general/android:com.topjoy.sdk_demo?hl=zh-cn" >https://console.firebase.google.com/u/1/project/dao-project-380602/settings/general/android:com.topjoy.sdk_demo?hl=zh-cn<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-02-18-30-20.png"
                      alt="002"
                ></p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><ol>
<li><p>同一个包名，使用不同的签名keystore，最终打出的包签名是不一致的</p>
</li>
<li><p>如果打出的包签名SHA-1 SHA-256在firebase后台未配置，那么谷歌相关能力则无法使用，比如谷歌登录会失败，返回错误码10<br>  解决2的问题，可以使用同一个包名，或者把打出的包签名添加到firabse后台</p>
</li>
<li><p>android studio配置签名keystore<br> 在gradle文件添加配置</p>
 <div class="code-container" data-rel="Gradle"><figure class="iseeu highlight gradle"><table><tr><td class="code"><pre><span class="line">    signingConfigs &#123;</span><br><span class="line">    config &#123;<span class="comment">//谷歌支付使用的jks</span></span><br><span class="line">        storeFile <span class="keyword">file</span>(<span class="string">&#x27;mujianchen.jsk&#x27;</span>)</span><br><span class="line">        keyAlias <span class="string">&#x27;mujianchen&#x27;</span></span><br><span class="line">        keyPassword <span class="string">&#x27;mu123456&#x27;</span></span><br><span class="line">        storePassword <span class="string">&#x27;mu123456&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ylconfig &#123;<span class="comment">//可以用来测试的签名</span></span><br><span class="line">        storeFile <span class="keyword">file</span>(<span class="string">&#x27;youle.jks&#x27;</span>)</span><br><span class="line">        keyAlias <span class="string">&#x27;youle&#x27;</span></span><br><span class="line">        keyPassword <span class="string">&#x27;yl123456&#x27;</span></span><br><span class="line">        storePassword <span class="string">&#x27;yl123456&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>unity配置签名：在player-settings中<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-02-18-30-40.png"
                      alt="003"
                ></p>
</li>
</ol>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Github Pages+Hexo+Waline+Leancloud+Artitalk搭建个人博客</title>
    <url>/2025/01/04/Github-Pages-Hexo-Waline-Leancloud-Artitalk%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Real-ESRGAN 图像和视频AI修复工具使用</title>
    <url>/2025/01/06/Real-ESRGAN-%E5%9B%BE%E5%83%8F%E5%92%8C%E8%A7%86%E9%A2%91AI%E4%BF%AE%E5%A4%8D%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>在我们的日常中，对于一些年代比较久远的图片 or 视频，我们希望可以进行一些修复，但是现在很多软件都比较耗费性能，或者需要付费，我们希望有一个比较轻量级的软件，可以进行一些修复，并且可以免费使用。<br>然后在 github 偶然发现了这个工具，记录一下使用的过程和遇到的问题。</p>
<h2 id="前置准备"><a href="#前置准备" class="headerlink" title="前置准备"></a>前置准备</h2><blockquote>
<p>工具 github地址 <a class="link"   href="https://github.com/xinntao/Real-ESRGAN" >Real-ESRGAN<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</blockquote>
<ol>
<li><p>克隆代码到本地 <code>git clone https://github.com/xinntao/Real-ESRGAN.git</code></p>
</li>
<li><p>安装依赖 <code>pip install basicsr</code><br>这时候遇到了报错，basicsr 安装失败，错误信息</p>
<div class="code-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">pip install basicsr</span><br><span class="line">Collecting basicsr</span><br><span class="line">Using cached basicsr-1.4.2.tar.gz (172 kB)</span><br><span class="line">Installing build dependencies ... done</span><br><span class="line">Getting requirements to build wheel ... error</span><br><span class="line">error: subprocess-exited-with-error</span><br><span class="line"></span><br><span class="line">× Getting requirements to build wheel did not run successfully.</span><br><span class="line">│ exit code: 1</span><br><span class="line">╰─&gt; [24 lines of output]</span><br><span class="line">      Traceback (most recent call last):</span><br><span class="line">      File &quot;/Users/topjoy/PycharmProjects/Real-ESRGAN/venv/lib/python3.13/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py&quot;, line 353, in &lt;module&gt;</span><br><span class="line">         main()</span><br><span class="line">         ~~~~^^</span><br><span class="line">      File &quot;/Users/topjoy/PycharmProjects/Real-ESRGAN/venv/lib/python3.13/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py&quot;, line 335, in main</span><br><span class="line">         json_out[&#x27;return_val&#x27;] = hook(**hook_input[&#x27;kwargs&#x27;])</span><br><span class="line">                                 ~~~~^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">      File &quot;/Users/topjoy/PycharmProjects/Real-ESRGAN/venv/lib/python3.13/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py&quot;, line 118, in get_requires_for_build_wheel</span><br><span class="line">         return hook(config_settings)</span><br><span class="line">      File &quot;/private/var/folders/h7/b_kcqfhn5t7cs_w3p6ks093w0000gn/T/pip-build-env-gfw___4v/overlay/lib/python3.13/site-packages/setuptools/build_meta.py&quot;, line 334, in get_requires_for_build_wheel</span><br><span class="line">         return self._get_build_requires(config_settings, requirements=[])</span><br><span class="line">               ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">      File &quot;/private/var/folders/h7/b_kcqfhn5t7cs_w3p6ks093w0000gn/T/pip-build-env-gfw___4v/overlay/lib/python3.13/site-packages/setuptools/build_meta.py&quot;, line 304, in _get_build_requires</span><br><span class="line">         self.run_setup()</span><br><span class="line">         ~~~~~~~~~~~~~~^^</span><br><span class="line">      File &quot;/private/var/folders/h7/b_kcqfhn5t7cs_w3p6ks093w0000gn/T/pip-build-env-gfw___4v/overlay/lib/python3.13/site-packages/setuptools/build_meta.py&quot;, line 522, in run_setup</span><br><span class="line">         super().run_setup(setup_script=setup_script)</span><br><span class="line">         ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">      File &quot;/private/var/folders/h7/b_kcqfhn5t7cs_w3p6ks093w0000gn/T/pip-build-env-gfw___4v/overlay/lib/python3.13/site-packages/setuptools/build_meta.py&quot;, line 320, in run_setup</span><br><span class="line">         exec(code, locals())</span><br><span class="line">         ~~~~^^^^^^^^^^^^^^^^</span><br><span class="line">      File &quot;&lt;string&gt;&quot;, line 149, in &lt;module&gt;</span><br><span class="line">      File &quot;&lt;string&gt;&quot;, line 79, in get_version</span><br><span class="line">      KeyError: &#x27;__version__&#x27;</span><br><span class="line">      [end of output]</span><br><span class="line"></span><br><span class="line">note: This error originates from a subprocess, and is likely not a problem with pip.</span><br><span class="line">error: subprocess-exited-with-error</span><br><span class="line"></span><br><span class="line">× Getting requirements to build wheel did not run successfully.</span><br><span class="line">│ exit code: 1</span><br><span class="line">╰─&gt; See above for output.</span><br><span class="line">note: This error originates from a subprocess, and is likely not a problem with pip.</span><br></pre></td></tr></table></figure></div>

<p>解决办法：</p>
<ol>
<li>更新 setuptools 和 pip 版本 <code>pip install --upgrade pip setuptools wheel</code></li>
<li>安装 torch、opencv <code>pip install torch opencv-python</code><br>此时因为我本地的python 版本是 3.13，torch 不支持 3.13，官方文档的支持是 3.9～3.12，所以更换使用 3.12 版本<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-06-15-25-33.png"
                      alt="2025-01-06-15-25-33.png"
                ><blockquote>
<p><a class="link"   href="https://pytorch.org/get-started/locally/" >PyTorch<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</blockquote>
</li>
<li>更换版本后，basicsr 安装成功</li>
</ol>
</li>
</ol>
<h2 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h2><p>根据官方文档针对于普通图片和动图有两个提供好的模型使用，分别是 RealESRGAN_x4plus 和 RealESRGAN_x4plus_anime_6B</p>
<h3 id="普通图片"><a href="#普通图片" class="headerlink" title="普通图片"></a>普通图片</h3><p>使用模型RealESRGAN_x4plus.pth</p>
<div class="code-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载模型</span></span><br><span class="line">wget https://github.com/xinntao/Real-ESRGAN/releases/download/v0.1.0/RealESRGAN_x4plus.pth -P weights </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">推断即运行，源文件放在 inputs 目录下</span></span><br><span class="line">python inference_realesrgan.py -n RealESRGAN_x4plus -i inputs --face_enhance</span><br></pre></td></tr></table></figure></div>

<h3 id="动图"><a href="#动图" class="headerlink" title="动图"></a>动图</h3><p>使用模型RealESRGAN_x4plus_anime_6B</p>
<div class="code-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载模型</span></span><br><span class="line">wget https://github.com/xinntao/Real-ESRGAN/releases/download/v0.2.2.4/RealESRGAN_x4plus_anime_6B.pth -P weights</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">推断即运行，源文件放在 inputs 目录下</span></span><br><span class="line">python inference_realesrgan.py -n RealESRGAN_x4plus_anime_6B -i inputs</span><br></pre></td></tr></table></figure></div>

<p>运行成功后，会在 outputs 目录下生成处理后的图片，可以查看效果。</p>
<h2 id="输出尺寸的自定义"><a href="#输出尺寸的自定义" class="headerlink" title="输出尺寸的自定义"></a>输出尺寸的自定义</h2><p>RealESRGAN_x4plus.pth模型默认使用 X4即4倍的超分辨率，但是可以通过自定义命令参数<code>outscale</code>来修改输出尺寸。</p>
<div class="code-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">Usage: python inference_realesrgan.py -n RealESRGAN_x4plus -i infile -o outfile [options]...</span><br><span class="line"></span><br><span class="line">A common command: python inference_realesrgan.py -n RealESRGAN_x4plus -i infile --outscale 3.5 --face_enhance</span><br><span class="line"></span><br><span class="line">  -h                   show this help</span><br><span class="line">  -i --input           Input image or folder. Default: inputs</span><br><span class="line">  -o --output          Output folder. Default: results</span><br><span class="line">  -n --model_name      Model name. Default: RealESRGAN_x4plus</span><br><span class="line">  -s, --outscale       The final upsampling scale of the image. Default: 4</span><br><span class="line">  --suffix             Suffix of the restored image. Default: out</span><br><span class="line">  -t, --tile           Tile size, 0 for no tile during testing. Default: 0</span><br><span class="line">  --face_enhance       Whether to use GFPGAN to enhance face. Default: False</span><br><span class="line">  --fp32               Whether to use half precision during inference. Default: False</span><br><span class="line">  --ext                Image extension. Options: auto | jpg | png, auto means using the same extension as inputs. Default: auto</span><br></pre></td></tr></table></figure></div>

<h2 id="懒人版本"><a href="#懒人版本" class="headerlink" title="懒人版本"></a>懒人版本</h2><p>官方提供了可执行文件，支持 Windows  Linux 和 MacOS，直接下载即可使用。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-06-15-50-40.png"
                      alt="2025-01-06-15-50-40.png"
                ><br>我体验使用了 mac os。</p>
<h3 id="如果是图片"><a href="#如果是图片" class="headerlink" title="如果是图片"></a>如果是图片</h3><div class="code-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">./realesrgan-ncnn-vulkan.exe -i 输入图像.jpg -o 输出图像.png -n 模型名字</span><br></pre></td></tr></table></figure></div>

<h3 id="如果是视频"><a href="#如果是视频" class="headerlink" title="如果是视频"></a>如果是视频</h3><p>其实原理就是把视频拆分成一帧一帧的图片，先处理一张张图片，然后再合成成视频。</p>
<ol>
<li><p>Use ffmpeg to extract frames from a video (Remember to create the folder <code>tmp_frames</code> ahead)<br>创建解压目录tmp_frames，ffmpeg 需要手动安装一下 <code>brew install ffmpeg</code></p>
<div class="code-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">ffmpeg -i onepiece_demo.mp4 -qscale:v 1 -qmin 1 -qmax 1 -vsync 0 tmp_frames/frame%08d.jpg</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>Inference with Real-ESRGAN executable file (Remember to create the folder <code>out_frames</code> ahead)<br>创建处理输出目录out_frames，使用模型realesr-animevideov3，放大倍数2，输出格式jpg（也可以使用提供的其他模型）</p>
<div class="code-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">./realesrgan-ncnn-vulkan -i tmp_frames -o out_frames -n realesr-animevideov3 -s 2 -f jpg</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>Merge the enhanced frames back into a video<br>把处理输出的图片再集成成视频</p>
<div class="code-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">ffmpeg -i out_frames/frame%08d.jpg -i onepiece_demo.mp4 -map 0:v:0 -map 1:a:0 -c:a copy -c:v libx264 -r 23.98 -pix_fmt yuv420p output_w_audio.mp4</span><br></pre></td></tr></table></figure></div></li>
</ol>
<h2 id="使用效果对比"><a href="#使用效果对比" class="headerlink" title="使用效果对比"></a>使用效果对比</h2><p>这个是我源文件的分辨率的预览<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-06-15-57-52.png"
                      alt="2025-01-06-15-57-52.png"
                ></p>
<p>这个是使用模型RealESRGAN_x4plus.pth处理后的结果，分辨率接近 8K(源文件太大了，直接粘进来很卡就截了一张对比图，可能效果不明显，可以自己体验一下，对比真的很明显)<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-06-15-58-53.png"
                      alt="2025-01-06-15-58-53.png"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-06-16-01-41.png"
                      alt="2025-01-06-16-01-41.png"
                ></p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>图像修复</tag>
      </tags>
  </entry>
  <entry>
    <title>c# 中 method new 和 overide 的差异</title>
    <url>/2025/01/03/c-%E4%B8%AD-method-new-%E5%92%8C-overide-%E7%9A%84%E5%B7%AE%E5%BC%82/</url>
    <content><![CDATA[<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-03-12-55-10.png"
                      alt="001"
                ></p>
<h2 id="new使用"><a href="#new使用" class="headerlink" title="new使用"></a>new使用</h2><div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BaseClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowMessage</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Message from BaseClass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DerivedClass</span> : <span class="title">BaseClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用 new 隐藏基类中的 ShowMessage 方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">new</span> <span class="keyword">void</span> <span class="title">ShowMessage</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Message from DerivedClass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        BaseClass baseObj = <span class="keyword">new</span> BaseClass();</span><br><span class="line">        baseObj.ShowMessage();  <span class="comment">// 输出：Message from BaseClass</span></span><br><span class="line">        </span><br><span class="line">        DerivedClass derivedObj = <span class="keyword">new</span> DerivedClass();</span><br><span class="line">        derivedObj.ShowMessage();  <span class="comment">// 输出：Message from DerivedClass</span></span><br><span class="line">        </span><br><span class="line">        BaseClass baseRef = <span class="keyword">new</span> DerivedClass();</span><br><span class="line">        baseRef.ShowMessage();  <span class="comment">// 输出：Message from BaseClass（基类方法被调用，因为它使用基类引用）</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h2 id="overide使用"><a href="#overide使用" class="headerlink" title="overide使用"></a>overide使用</h2><div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BaseClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ShowMessage</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Message from BaseClass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DerivedClass</span> : <span class="title">BaseClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用 override 重写基类的 ShowMessage 方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">ShowMessage</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Message from DerivedClass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        BaseClass baseObj = <span class="keyword">new</span> BaseClass();</span><br><span class="line">        baseObj.ShowMessage();  <span class="comment">// 输出：Message from BaseClass</span></span><br><span class="line">        </span><br><span class="line">        DerivedClass derivedObj = <span class="keyword">new</span> DerivedClass();</span><br><span class="line">        derivedObj.ShowMessage();  <span class="comment">// 输出：Message from DerivedClass</span></span><br><span class="line">        </span><br><span class="line">        BaseClass baseRef = <span class="keyword">new</span> DerivedClass();</span><br><span class="line">        baseRef.ShowMessage();  <span class="comment">// 输出：Message from DerivedClass（调用派生类的方法）</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>c#</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2024/12/31/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a class="link"   href="https://hexo.io/" >Hexo<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a>! This is your very first post. Check <a class="link"   href="https://hexo.io/docs/" >documentation<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a> for more info. If you get any problems when using Hexo, you can find the answer in <a class="link"   href="https://hexo.io/docs/troubleshooting.html" >troubleshooting<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a> or you can ask me on <a class="link"   href="https://github.com/hexojs/hexo/issues" >GitHub<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>More info: <a class="link"   href="https://hexo.io/docs/writing.html" >Writing<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure></div>

<p>More info: <a class="link"   href="https://hexo.io/docs/server.html" >Server<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">hexo generate or hexo g</span><br></pre></td></tr></table></figure></div>

<p>More info: <a class="link"   href="https://hexo.io/docs/generating.html" >Generating<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">hexo deploy or hexo d</span><br></pre></td></tr></table></figure></div>

<p>More info: <a class="link"   href="https://hexo.io/docs/one-command-deployment.html" >Deployment<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>unitypackage类型文件解压,import,export</title>
    <url>/2025/01/07/unitypackage%E7%B1%BB%E5%9E%8B%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B-import-export/</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>痛点：</p>
<p>在 2019 版本的 unity 编辑器中，会将 iOS 依赖的<code>.bundle</code>,<code>.framework</code>文件识别为一个目录的格式，而 2022 版本的 unity 编辑器会将其识别为一个文件，导致现存的 export 的脚本无法正常导出这两种类型的文件，最终生成的 unitypackage 文件中会缺少<code>.bundle</code>,<code>.framework</code></p>
<p>解决办法：</p>
<p>查询和 GPT 无果后决定使用最简单的方式，把<code>.bundle</code>,<code>.framework</code>文件作为一个文件类型导出。</p>
<h2 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h2><p>源代码</p>
<div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">string</span> packageName = <span class="string">&quot;ZeusSDK.unitypackage&quot;</span>;</span><br><span class="line"><span class="comment">//需要添加到unitypackage的目录</span></span><br><span class="line"><span class="built_in">string</span>[] dirs = <span class="keyword">new</span> <span class="built_in">string</span>[]</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;Adjust&quot;</span>, <span class="string">&quot;Editor&quot;</span>, <span class="string">&quot;ExternalDependencyManager&quot;</span>, <span class="string">&quot;GravityEngine&quot;</span>, <span class="string">&quot;Resources&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ThinkingAnalytics&quot;</span>, <span class="string">&quot;WebGLTemplates&quot;</span>, <span class="string">&quot;WX-WASM-SDK-V2&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line">locationPathName += <span class="string">&quot;/&quot;</span> + packageName; </span><br><span class="line"><span class="comment">//需要打包的资源</span></span><br><span class="line">List&lt;Object&gt; objs = <span class="keyword">new</span> List&lt;Object&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//需要打包的资源的路径</span></span><br><span class="line">List&lt;<span class="built_in">string</span>[]&gt; assets = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>[]&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="built_in">string</span> dir <span class="keyword">in</span> dirs)</span><br><span class="line">&#123;</span><br><span class="line">    Debug.Log(<span class="string">$&quot;dir:<span class="subst">&#123;dir&#125;</span>&quot;</span>);</span><br><span class="line">    assets.Add(Directory.GetFiles(Application.dataPath + <span class="string">&quot;/&quot;</span> + dir, <span class="string">&quot;*&quot;</span>, SearchOption.AllDirectories));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//循环遍历每一个路径，单独加载</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; assets.Count; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">string</span> strPath <span class="keyword">in</span> assets[i])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> strTempPath = strPath;</span><br><span class="line">        <span class="comment">//截取我们需要的相对路径</span></span><br><span class="line">        strTempPath = strTempPath.Substring(strTempPath.IndexOf(<span class="string">&quot;Assets&quot;</span>));</span><br><span class="line">        <span class="comment">//过滤meta文件</span></span><br><span class="line">        <span class="keyword">if</span> (strTempPath.EndsWith(<span class="string">&quot;.meta&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//根据路径加载资源</span></span><br><span class="line">        Object obj = AssetDatabase.LoadAssetAtPath(strTempPath, <span class="keyword">typeof</span>(Object));</span><br><span class="line">        objs.Add(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> assetPathNames = <span class="keyword">new</span> <span class="built_in">string</span>[objs.Count];</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取每个资源的相对路径</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; assetPathNames.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">    assetPathNames[i] = AssetDatabase.GetAssetPath(objs[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取与资源有依赖关系的所有资源列表</span></span><br><span class="line">assetPathNames = AssetDatabase.GetDependencies(assetPathNames);</span><br><span class="line"></span><br><span class="line"><span class="comment">//排除项目有可能生成的文件，防止与项目冲突，使用文档指导配置过程</span></span><br><span class="line"><span class="built_in">string</span> androidRoot = <span class="string">&quot;Assets/Plugins/Android/&quot;</span>;</span><br><span class="line"></span><br><span class="line">List&lt;<span class="built_in">string</span>&gt; excludeFiles = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;&#123;</span><br><span class="line">    <span class="string">&quot;Assets/Editor/ExportPackage.cs&quot;</span>,</span><br><span class="line">    androidRoot + <span class="string">&quot;baseProjectTemplate.gradle&quot;</span>,</span><br><span class="line">    androidRoot + <span class="string">&quot;launcherTemplate.gradle&quot;</span>,</span><br><span class="line">    androidRoot + <span class="string">&quot;mainTemplate.gradle&quot;</span>,</span><br><span class="line">    androidRoot + <span class="string">&quot;gradleTemplate.properties&quot;</span>,</span><br><span class="line">    androidRoot + <span class="string">&quot;LauncherManifest.xml&quot;</span>,</span><br><span class="line">    androidRoot + <span class="string">&quot;AndroidManifest.xml&quot;</span>,</span><br><span class="line">    androidRoot + <span class="string">&quot;google-services.json&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Assets/Plugins/iOS/ZeusSDK/ZeusSDKInfo.plist&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Assets/Plugins/iOS/ZeusSDK/GoogleService-Info.plist&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">List&lt;<span class="built_in">string</span>&gt; exportAssets = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="built_in">string</span> assetPath <span class="keyword">in</span> assetPathNames)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!excludeFiles.Contains(assetPath))&#123;</span><br><span class="line">        exportAssets.Add(assetPath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//打包Package 最后三个参数分别是:导出操作将异步运行，在导出完成之后在文件浏览窗口显示导出包文件 | 将通过任何子目录列表递归并包含所有资源 | 除了列出的资产路径，所有相关资产将被包括在内</span></span><br><span class="line">AssetDatabase.ExportPackage(exportAssets.ToArray(), locationPathName, ExportPackageOptions.Recurse | ExportPackageOptions.IncludeDependencies);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<ol>
<li>调用<code>Directory.GetFiles</code>去遍历所有的目录，对于<code>.bundle</code>,<code>.framework</code>文件，<code>Directory.GetFiles</code>可以识别为目录，并且找到下面的所有子目录和文件</li>
<li>但是对于<code>AssetDatabase.LoadAssetAtPath</code>无法将路径中包含<code>.bundle</code>,<code>.framework</code>的文件识别为一个objeject，那么导致添加到 objs 中的都是 null</li>
<li>从而导致<code>AssetDatabase.GetAssetPath</code>去获取路径的时候无法获取到，最终导致<code>AssetDatabase.ExportPackage</code>导出的unitypackage 中缺少路径中包含 <code>.bundle</code>,<code>.framework</code>的文件</li>
</ol>
<h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><ol>
<li>刚开始想看看有没有人遇到类似问题以及解决，但是没发现有人问类似的问题</li>
<li>然后看了一下 unity 官方 api 文档，也没有针对于 .bundle, .framework 文件的特殊处理</li>
<li>所以最终决定用最粗暴的把路径名中包含<code>.bundle</code>,<code>.framework</code>的文件，找到<code>.bundle</code>,<code>.framework</code>这一级作为付目录，直接导出<code>.bundle</code>,<code>.framework</code>文件<br>即：<br>如果路径为<code>abc/def/g.bundle/xxx/xx</code>，<code>abc/def/g.bundle/xxx</code>则只导出<code>abc/def/g.bundle</code>文件，<code>.framework</code>文件&#96; 同理</li>
</ol>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div class="code-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 辅助函数：提取 .bundle 和 .framework文件的父目录路径</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">GetAssetDirectory</span>(<span class="params"><span class="built_in">string</span> path, <span class="built_in">string</span> extension</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> extensionIndex = path.IndexOf(extension);</span><br><span class="line">    <span class="keyword">if</span> (extensionIndex == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">string</span>.Empty;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从路径中提取出扩展名对应的文件目录</span></span><br><span class="line">    <span class="keyword">return</span> path.Substring(<span class="number">0</span>, extensionIndex + extension.Length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 检查路径中是否包含 .bundle 文件</span></span><br><span class="line"><span class="keyword">if</span> (strTempPath.Contains(<span class="string">&quot;.bundle&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 提取 .bundle 文件的父目录</span></span><br><span class="line">    <span class="built_in">string</span> bundleDirectory = GetAssetDirectory(strTempPath, <span class="string">&quot;.bundle&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果当前已经处理过这个 bundle 目录，就跳过</span></span><br><span class="line">    <span class="keyword">if</span> (processedBundles.Contains(bundleDirectory))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 标记此 bundle 目录已经处理过</span></span><br><span class="line">    processedBundles.Add(bundleDirectory);</span><br><span class="line">    <span class="comment">// 加载 .bundle 文件并直接作为一个资源添加</span></span><br><span class="line">    Object asset = AssetDatabase.LoadAssetAtPath(bundleDirectory, <span class="keyword">typeof</span>(Object));</span><br><span class="line">    <span class="keyword">if</span> (asset != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        objs.Add(asset); <span class="comment">// 直接添加整个 .bundle 文件</span></span><br><span class="line">        Debug.Log(<span class="string">$&quot;Added .bundle file as asset: <span class="subst">&#123;bundleDirectory&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.LogWarning(<span class="string">$&quot;Failed to load .bundle asset: <span class="subst">&#123;bundleDirectory&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (strTempPath.Contains(<span class="string">&quot;.framework&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 提取 .framework 文件的目录</span></span><br><span class="line">    <span class="built_in">string</span> frameworkDirectory = GetAssetDirectory(strTempPath, <span class="string">&quot;.framework&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果当前已经处理过这个 .framework 目录，就跳过</span></span><br><span class="line">    <span class="keyword">if</span> (processedBundles.Contains(frameworkDirectory))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 标记此 .framework 目录已经处理过</span></span><br><span class="line">    processedBundles.Add(frameworkDirectory);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载 .framework 文件并直接作为一个资源添加</span></span><br><span class="line">    Object asset = AssetDatabase.LoadAssetAtPath(frameworkDirectory, <span class="keyword">typeof</span>(Object));</span><br><span class="line">    <span class="keyword">if</span> (asset != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        objs.Add(asset); <span class="comment">// 直接添加整个 .framework 文件</span></span><br><span class="line">        Debug.Log(<span class="string">$&quot;Added .framework file as asset: <span class="subst">&#123;frameworkDirectory&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.LogWarning(<span class="string">$&quot;Failed to load .framework asset: <span class="subst">&#123;frameworkDirectory&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h2><p>对于以这种方式导出的unitypackage，是否和 unity 编辑器本身的导出方式一致，需要测试</p>
<ol>
<li>使用脚本导出文件大小和使用 unity 编辑器的窗口工具导出大小一致<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-07-18-00-58.png"
                      alt="2025-01-07-18-00-58.png"
                ></li>
<li>使用空工程先后导入两个 package，不存在文件 new 差异<br>遇到的问题是即使导入完全一样的 package 两次，.png, .strings, .h, .plist, .nib 这些文件会被再次标记为 new，即使是使用 unity 的 aeests export package 导出的包也是如此，所以可以认为脚本导出的包该行为不存在问题</li>
<li>import 导入脚本导出的项目后测试功能正常</li>
</ol>
<h2 id="其他tips"><a href="#其他tips" class="headerlink" title="其他tips"></a>其他tips</h2><p>本来想通过解压 unitypackage 然后结合 beyond compare 来比较两个包，但是发现解压之后包中的文件过多，以及一些<code>.meta</code>文件导致的差异无法忽略，所以最有效的方式还是分别 import 的形式进行比较。</p>
<p>unitypackage 解压命令</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">tar -xvf abc.unitypackage -C temp</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>unity3D</tag>
      </tags>
  </entry>
  <entry>
    <title>对对碰游戏概率计算</title>
    <url>/2025/01/03/%E5%AF%B9%E5%AF%B9%E7%A2%B0%E6%B8%B8%E6%88%8F%E6%A6%82%E7%8E%87%E8%AE%A1%E7%AE%97/</url>
    <content><![CDATA[<h2 id="🎮游戏规则"><a href="#🎮游戏规则" class="headerlink" title="🎮游戏规则"></a>🎮游戏规则</h2><ol>
<li>牌堆包含 1-9 每个数字 5 张，以及一张 luck 运气牌，总共 46 张牌；</li>
<li>游戏开始，选择一个许愿数字，初始化游戏区从牌堆随机抽取 9 张牌，抽走后，牌堆需要去除这9张牌；</li>
<li>游戏区每次匹配2张相同数字的牌，得 1 分，移除匹配牌并从牌堆抽取补充 1 张新牌，随机补充的牌是可能和游戏区的数字相同的；</li>
<li>如果游戏区出现luck运气牌则从牌堆抽取补充 3 张新牌，补充的3张牌之间可能相同，也可能不同，补充的3张牌是可能和游戏区的数字相同的；</li>
<li>如果游戏区出现许愿数字，匹配2张该许愿数字的牌后，不仅补充 1 张牌，还要从牌堆抽取补充 2 张额外的牌，总共从牌堆抽取补充 3 张；</li>
<li>如果最终得分大于等于5，那么再从牌堆抽取1张，如果出现匹配2张相同数字的牌，则重复上述操作，然后再计算最终得分；</li>
<li>记录每次模拟得到最高得分，并记录得到最高得分时的匹配和补充牌的详情；</li>
<li>每次模拟次数1w次；</li>
<li>最后统计每个分值出现次数，并生成正态分布图。</li>
</ol>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化牌堆：包含1-9每个数字5张，以及1张luck运气牌</span></span><br><span class="line">deck = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)] + [<span class="string">&#x27;luck&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(deck)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 规则参数</span></span><br><span class="line">initial_game_zone_size = <span class="number">9</span>  <span class="comment"># 初始游戏区的牌数</span></span><br><span class="line">max_card_count = <span class="number">5</span>  <span class="comment"># 每个数字出现的最大次数</span></span><br><span class="line">max_luck_count = <span class="number">1</span>  <span class="comment"># 运气牌最大出现次数</span></span><br><span class="line">max_total_cards = <span class="number">46</span>  <span class="comment"># 总牌数上限</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 游戏区的初始化</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">draw_initial_game_zone</span>():</span><br><span class="line">    <span class="built_in">print</span>(random.sample(deck, initial_game_zone_size))</span><br><span class="line">    <span class="keyword">return</span> random.sample(deck, initial_game_zone_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从牌堆中随机抽取牌</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">draw_from_deck</span>(<span class="params">deck, total_counter</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> deck:  <span class="comment"># 检查牌堆是否为空</span></span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;牌堆已空，无法继续抽牌！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 避免违反规则：检查每个数字和运气牌的数量</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        card = random.choice(deck)  <span class="comment"># 选择一个元素不做删除</span></span><br><span class="line">        total_counter.update([card])</span><br><span class="line">        <span class="comment"># 统计游戏区中每个卡牌的数量</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(card, <span class="built_in">int</span>) <span class="keyword">and</span> total_counter[card] &gt; max_card_count:</span><br><span class="line">            <span class="keyword">continue</span>  <span class="comment"># 如果该数字的出现次数已达到上限，继续选择</span></span><br><span class="line">        <span class="keyword">elif</span> card == <span class="string">&#x27;luck&#x27;</span> <span class="keyword">and</span> total_counter[<span class="string">&#x27;luck&#x27;</span>] &gt; max_luck_count:</span><br><span class="line">            <span class="keyword">continue</span>  <span class="comment"># 如果运气牌已达到上限，继续选择</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(deck) &gt; max_total_cards:</span><br><span class="line">            <span class="keyword">continue</span>  <span class="comment"># 如果总牌数超出上限，继续选择</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 一旦选中符合条件的卡牌，就可以返回</span></span><br><span class="line">        deck.remove(card)  <span class="comment"># 从排堆拿走抽走的牌</span></span><br><span class="line">        <span class="keyword">return</span> card</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行游戏</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play_game</span>():</span><br><span class="line">    score = <span class="number">0</span></span><br><span class="line">    deck_copy = deck.copy()  <span class="comment"># 副本用来模拟游戏</span></span><br><span class="line">    <span class="comment"># 用于统计所有曾经出现过的卡片的总次数</span></span><br><span class="line">    game_zone = draw_initial_game_zone()  <span class="comment"># 随机抽取9张牌</span></span><br><span class="line">    game_zone_counter = Counter(game_zone)</span><br><span class="line">    <span class="comment"># 用于统计所有曾经出现过的卡片的总次数</span></span><br><span class="line">    total_counter = Counter(game_zone)  <span class="comment"># 计算每个数字在游戏区中的数量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 随机选择许愿数字，范围从1到9</span></span><br><span class="line">    wish_number = random.choice(<span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;本轮游戏的许愿数字是: <span class="subst">&#123;wish_number&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;初始游戏区: <span class="subst">&#123;game_zone&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 记录抽牌顺序</span></span><br><span class="line">    draw_sequence = []</span><br><span class="line">    game_zone_history = []  <span class="comment"># 用于记录游戏区每次的变化</span></span><br><span class="line">    card_additions = []  <span class="comment"># 用于记录每一步补充了哪些牌以及补充的原因</span></span><br><span class="line">    current_total_counter = []</span><br><span class="line">    additional_card_step = <span class="literal">None</span>  <span class="comment"># 用于标记哪一步因为得分大于等于5而增加了一张牌</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">any</span>(count &gt;= <span class="number">2</span> <span class="keyword">for</span> count <span class="keyword">in</span> game_zone_counter.values()):  <span class="comment"># 游戏继续直到没有可匹配的牌</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;当前游戏区: <span class="subst">&#123;game_zone&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;当前得分: <span class="subst">&#123;score&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 记录当前游戏区的状态</span></span><br><span class="line">        game_zone_history.append(game_zone.copy())</span><br><span class="line">        current_total_counter.append(total_counter.copy())</span><br><span class="line">        <span class="comment"># 查找是否有可以匹配的数字（数量大于等于2）</span></span><br><span class="line">        matched = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> number, count <span class="keyword">in</span> game_zone_counter.items():</span><br><span class="line">            <span class="keyword">if</span> count &gt;= <span class="number">2</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;匹配数字 <span class="subst">&#123;number&#125;</span>，得分 +1&quot;</span>)</span><br><span class="line">                <span class="comment"># 记录需要删除的索引</span></span><br><span class="line">                to_remove_indices = []</span><br><span class="line">                <span class="comment"># 确保只移除前两个</span></span><br><span class="line">                removed_count = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> i, card <span class="keyword">in</span> <span class="built_in">enumerate</span>(game_zone):</span><br><span class="line">                    <span class="keyword">if</span> card == number <span class="keyword">and</span> removed_count &lt; <span class="number">2</span>:</span><br><span class="line">                        to_remove_indices.append(i)</span><br><span class="line">                        removed_count += <span class="number">1</span></span><br><span class="line">                        <span class="keyword">if</span> removed_count == <span class="number">2</span>:</span><br><span class="line">                            <span class="keyword">break</span>  <span class="comment"># 已经移除两个，跳出循环</span></span><br><span class="line">                <span class="comment"># 删除记录的卡牌</span></span><br><span class="line">                <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">sorted</span>(to_remove_indices, reverse=<span class="literal">True</span>):  <span class="comment"># 反向删除避免索引变化</span></span><br><span class="line">                    game_zone.pop(index)</span><br><span class="line"></span><br><span class="line">                score += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 处理补充牌的部分，确保每次只补充3张牌</span></span><br><span class="line">                <span class="keyword">if</span> number == wish_number:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;许愿数字 <span class="subst">&#123;number&#125;</span> 匹配成功，补充3张牌&quot;</span>)</span><br><span class="line">                    added_cards = []  <span class="comment"># 用来记录补充的卡牌</span></span><br><span class="line">                    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                        new_card = draw_from_deck(deck_copy, total_counter)</span><br><span class="line">                        game_zone.append(new_card)  <span class="comment"># 将新卡加入游戏区</span></span><br><span class="line">                        added_cards.append(new_card)  <span class="comment"># 将新卡加入记录的补充卡牌列表</span></span><br><span class="line">                        draw_sequence.append(new_card)  <span class="comment"># 记录抽牌顺序</span></span><br><span class="line">                    card_additions.append((added_cards, <span class="string">f&quot;许愿数字 <span class="subst">&#123;number&#125;</span> 匹配成功，补充3张牌:<span class="subst">&#123;added_cards&#125;</span>&quot;</span>))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;补充1张牌到游戏区&quot;</span>)</span><br><span class="line">                    added_cards = [draw_from_deck(deck_copy, total_counter)]</span><br><span class="line">                    game_zone.extend(added_cards)  <span class="comment"># 扩展游戏区，添加1张牌</span></span><br><span class="line">                    card_additions.append((added_cards, <span class="string">f&quot;匹配数字 <span class="subst">&#123;number&#125;</span>，补充1张牌<span class="subst">&#123;added_cards&#125;</span>&quot;</span>))</span><br><span class="line">                    draw_sequence.extend(added_cards)  <span class="comment"># 记录抽牌顺序充1张牌&quot;))</span></span><br><span class="line"></span><br><span class="line">                matched = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span>  <span class="comment"># 在一轮中匹配一对即可</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果抽到运气牌，补充3张新牌</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;luck&#x27;</span> <span class="keyword">in</span> game_zone:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;运气牌触发，补充3张牌&quot;</span>)</span><br><span class="line">            game_zone.remove(<span class="string">&#x27;luck&#x27;</span>)</span><br><span class="line">            added_cards = []</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                new_card = draw_from_deck(deck_copy, total_counter)</span><br><span class="line">                game_zone.append(new_card)</span><br><span class="line">                added_cards.append(new_card)</span><br><span class="line">                draw_sequence.append(new_card)  <span class="comment"># 记录抽牌顺序</span></span><br><span class="line">            card_additions.append((added_cards, <span class="string">&quot;运气牌触发，补充3张牌&quot;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 更新game_zone_counter</span></span><br><span class="line">        game_zone_counter = Counter(game_zone)</span><br><span class="line">        <span class="built_in">print</span>(game_zone_counter)</span><br><span class="line">        <span class="comment"># 如果没有匹配的牌并且没有运气牌，结束游戏</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> matched <span class="keyword">and</span> <span class="string">&#x27;luck&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> game_zone:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;正常游戏结束！最终得分：<span class="subst">&#123;score&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># 记录正常游戏结束后游戏区</span></span><br><span class="line">    game_zone_history.append(game_zone.copy())</span><br><span class="line">    current_total_counter.append(total_counter.copy())</span><br><span class="line">    <span class="comment"># 额外规则：如果得分大于等于5，并且牌堆中还有牌，继续抽一张牌</span></span><br><span class="line">    <span class="keyword">if</span> score &gt;= <span class="number">5</span> <span class="keyword">and</span> deck_copy:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;得分大于等于5，奶一口继续从牌堆中抽一张牌并计算新的得分。&quot;</span>)</span><br><span class="line">        <span class="comment"># new_card = draw_from_deck(deck_copy, total_counter)</span></span><br><span class="line">        <span class="comment"># game_zone.append(new_card)</span></span><br><span class="line">        <span class="comment"># draw_sequence.append(new_card)  # 记录抽牌顺序</span></span><br><span class="line">        <span class="comment"># additional_card_step = len(game_zone_history) + 1  # 标记在哪一步增加了一张牌</span></span><br><span class="line">        <span class="comment"># print(f&quot;奶一口新抽取的牌: &#123;new_card&#125;&quot;)</span></span><br><span class="line">        added_cards = [draw_from_deck(deck_copy, total_counter)]</span><br><span class="line">        game_zone.extend(added_cards)  <span class="comment"># 扩展游戏区，添加1张牌</span></span><br><span class="line">        game_zone_history.append(game_zone.copy())</span><br><span class="line">        current_total_counter.append(total_counter.copy())</span><br><span class="line">        card_additions.append((added_cards, <span class="string">f&quot;满足奶一口规则，补充1张牌<span class="subst">&#123;added_cards&#125;</span>&quot;</span>))</span><br><span class="line">        draw_sequence.extend(added_cards)  <span class="comment"># 记录抽牌顺序充1张牌&quot;))</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;奶一口新抽取的牌: <span class="subst">&#123;added_cards&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 重新计算得分</span></span><br><span class="line">        game_zone_counter = Counter(game_zone)</span><br><span class="line">        new_score = score</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 查找奶一口后是否有可以匹配的数字（数量大于等于2）</span></span><br><span class="line">        milk_matched = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># 查找是否有可以匹配的数字（数量大于等于2）</span></span><br><span class="line">        <span class="keyword">for</span> number, count <span class="keyword">in</span> game_zone_counter.items():</span><br><span class="line">            <span class="keyword">if</span> count &gt;= <span class="number">2</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;奶一口后匹配数字 <span class="subst">&#123;number&#125;</span>，得分 +1&quot;</span>)</span><br><span class="line">                <span class="comment"># 记录需要删除的索引</span></span><br><span class="line">                to_remove_indices = []</span><br><span class="line">                <span class="comment"># 确保只移除前两个</span></span><br><span class="line">                removed_count = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> i, card <span class="keyword">in</span> <span class="built_in">enumerate</span>(game_zone):</span><br><span class="line">                    <span class="keyword">if</span> card == number <span class="keyword">and</span> removed_count &lt; <span class="number">2</span>:</span><br><span class="line">                        to_remove_indices.append(i)</span><br><span class="line">                        removed_count += <span class="number">1</span></span><br><span class="line">                        <span class="keyword">if</span> removed_count == <span class="number">2</span>:</span><br><span class="line">                            <span class="keyword">break</span>  <span class="comment"># 已经移除两个，跳出循环</span></span><br><span class="line">                <span class="comment"># 删除记录的卡牌</span></span><br><span class="line">                <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">sorted</span>(to_remove_indices, reverse=<span class="literal">True</span>):  <span class="comment"># 反向删除避免索引变化</span></span><br><span class="line">                    game_zone.pop(index)</span><br><span class="line"></span><br><span class="line">                new_score += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 处理补充牌的部分，确保每次只补充3张牌</span></span><br><span class="line">                <span class="keyword">if</span> number == wish_number:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;奶一口后许愿数字 <span class="subst">&#123;number&#125;</span> 匹配成功，补充3张牌&quot;</span>)</span><br><span class="line">                    added_cards = []  <span class="comment"># 用来记录补充的卡牌</span></span><br><span class="line">                    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                        new_card = draw_from_deck(deck_copy, total_counter)</span><br><span class="line">                        game_zone.append(new_card)  <span class="comment"># 将新卡加入游戏区</span></span><br><span class="line">                        added_cards.append(new_card)  <span class="comment"># 将新卡加入记录的补充卡牌列表</span></span><br><span class="line">                        draw_sequence.append(new_card)  <span class="comment"># 记录抽牌顺序</span></span><br><span class="line">                    game_zone_history.append(game_zone.copy())</span><br><span class="line">                    current_total_counter.append(total_counter.copy())</span><br><span class="line">                    card_additions.append((added_cards, <span class="string">f&quot;奶一口后许愿数字 <span class="subst">&#123;number&#125;</span> 匹配成功，补充3张牌:<span class="subst">&#123;added_cards&#125;</span>&quot;</span>))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;奶一口后补充1张牌到游戏区&quot;</span>)</span><br><span class="line">                    added_cards = [draw_from_deck(deck_copy, total_counter)]</span><br><span class="line">                    game_zone.extend(added_cards)  <span class="comment"># 扩展游戏区，添加1张牌</span></span><br><span class="line">                    game_zone_history.append(game_zone.copy())</span><br><span class="line">                    current_total_counter.append(total_counter.copy())</span><br><span class="line">                    card_additions.append((added_cards, <span class="string">f&quot;奶一口后匹配数字 <span class="subst">&#123;number&#125;</span>，补充1张牌<span class="subst">&#123;added_cards&#125;</span>&quot;</span>))</span><br><span class="line">                    draw_sequence.extend(added_cards)  <span class="comment"># 记录抽牌顺序充1张牌&quot;))</span></span><br><span class="line"></span><br><span class="line">                milk_matched = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span>  <span class="comment"># 在一轮中匹配一对即可</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果抽到运气牌，补充3张新牌</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;luck&#x27;</span> <span class="keyword">in</span> game_zone:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;奶一口后运气牌触发，补充3张牌&quot;</span>)</span><br><span class="line">            game_zone.remove(<span class="string">&#x27;luck&#x27;</span>)</span><br><span class="line">            added_cards = []</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                new_card = draw_from_deck(deck_copy, total_counter)</span><br><span class="line">                game_zone.append(new_card)</span><br><span class="line">                added_cards.append(new_card)</span><br><span class="line">                draw_sequence.append(new_card)  <span class="comment"># 记录抽牌顺序</span></span><br><span class="line">            game_zone_history.append(game_zone.copy())</span><br><span class="line">            current_total_counter.append(total_counter.copy())</span><br><span class="line">            card_additions.append((added_cards, <span class="string">&quot;奶一口后运气牌触发，补充3张牌&quot;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 更新game_zone_counter</span></span><br><span class="line">        game_zone_counter = Counter(game_zone)</span><br><span class="line">        <span class="built_in">print</span>(game_zone_counter)</span><br><span class="line">        <span class="comment"># 如果没有匹配的牌并且没有运气牌，结束游戏</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> milk_matched <span class="keyword">and</span> <span class="string">&#x27;luck&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> game_zone:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;奶一口后也无法再加分&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;奶一口之后的新得分：<span class="subst">&#123;new_score&#125;</span>&quot;</span>)</span><br><span class="line">        score = new_score</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> score, draw_sequence, wish_number, game_zone_history,current_total_counter, card_additions, additional_card_step  <span class="comment"># 返回得分、抽牌顺序、许愿数字和增加牌的步骤</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟多次游戏，计算不同分数出现的频率</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">monte_carlo_simulation</span>(<span class="params">num_simulations=<span class="number">500000</span></span>):</span><br><span class="line">    highest_score = <span class="number">0</span></span><br><span class="line">    highest_score_sequence = []  <span class="comment"># 记录最高得分时的抽牌顺序</span></span><br><span class="line">    highest_wish_number = <span class="literal">None</span>  <span class="comment"># 记录最高得分时的许愿数字</span></span><br><span class="line">    highest_game_zone_history = []  <span class="comment"># 记录最高得分时的游戏区变化</span></span><br><span class="line">    highest_current_total_counter = []</span><br><span class="line">    highest_card_additions = []  <span class="comment"># 记录最高得分时的每步牌补充详情</span></span><br><span class="line">    highest_additional_card_step = <span class="literal">None</span>  <span class="comment"># 记录最高得分时增加牌的步骤</span></span><br><span class="line">    scores = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_simulations):</span><br><span class="line">        score, draw_sequence, wish_number, game_zone_history, current_total_counter,card_additions, additional_card_step = play_game()</span><br><span class="line">        scores.append(score)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 跟踪最高得分的模拟</span></span><br><span class="line">        <span class="keyword">if</span> score &gt; highest_score:</span><br><span class="line">            highest_score = score</span><br><span class="line">            highest_score_sequence = draw_sequence</span><br><span class="line">            highest_wish_number = wish_number</span><br><span class="line">            highest_game_zone_history = game_zone_history</span><br><span class="line">            highest_current_total_counter  = current_total_counter</span><br><span class="line">            highest_card_additions = card_additions</span><br><span class="line">            highest_additional_card_step = additional_card_step</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 绘制得分分布</span></span><br><span class="line">    plt.hist(scores, bins=<span class="built_in">range</span>(<span class="built_in">min</span>(scores), <span class="built_in">max</span>(scores) + <span class="number">1</span>), edgecolor=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">    plt.xlabel(<span class="string">&#x27;得分&#x27;</span>)</span><br><span class="line">    plt.ylabel(<span class="string">&#x27;出现次数&#x27;</span>)</span><br><span class="line">    plt.title(<span class="string">f&#x27;游戏得分分布（模拟 <span class="subst">&#123;num_simulations&#125;</span> 次）&#x27;</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> highest_score, highest_score_sequence, highest_wish_number, highest_game_zone_history,highest_current_total_counter, highest_card_additions, highest_additional_card_step</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进行多次模拟</span></span><br><span class="line">highest_score, highest_score_sequence, highest_wish_number, highest_game_zone_history,highest_current_total_counter, highest_card_additions, highest_additional_card_step = monte_carlo_simulation()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最高得分: <span class="subst">&#123;highest_score&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最高得分时的抽牌顺序: <span class="subst">&#123;highest_score_sequence&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最高得分时的许愿数字: <span class="subst">&#123;highest_wish_number&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印最高得分时的游戏区变化</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最高得分时的游戏区变化:&quot;</span>)</span><br><span class="line"><span class="comment"># for idx, history in enumerate(highest_game_zone_history, start=1):</span></span><br><span class="line"><span class="keyword">for</span> idx, (history, used_count) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(highest_game_zone_history, highest_current_total_counter), start=<span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;步骤 <span class="subst">&#123;idx&#125;</span>: <span class="subst">&#123;history&#125;</span>，已经用掉的卡牌次数：<span class="subst">&#123;used_count&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印每步牌补充的详细信息</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最高得分时的每步牌补充详情:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> idx, (cards, reason) <span class="keyword">in</span> <span class="built_in">enumerate</span>(highest_card_additions, start=<span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;步骤 <span class="subst">&#123;idx&#125;</span>: <span class="subst">&#123;reason&#125;</span> -&gt; 补充了: <span class="subst">&#123;cards&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最高得分时增加牌的步骤: <span class="subst">&#123;highest_additional_card_step&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<h2 id="游戏结果"><a href="#游戏结果" class="headerlink" title="游戏结果"></a>游戏结果</h2><p>正态分布图<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-03-18-35-53.png"
                      alt="2025-01-03-18-35-53"
                ><br>最高得分计算<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/mdimages/2025-01-03-18-36-26.png"
                      alt="2025-01-03-18-36-26.png"
                ></p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
</search>
